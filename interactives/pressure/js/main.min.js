!function($){var slc=slc||{},animationInProgress=!1,bkgStage,gaugeStage,tank1Stage,tank2Stage,tickmarkStage,queue,tank1,tank2,flowMeter,pressureMeter,selectedLevel1,selectedLevel2,units="meters",newData=[],plot1,b_updatingChart=!1,flow=0,V_T1=0,V_T2=0,lastFlowSpeed=0,d3Data1Staging=[],d3Data2Staging=[],flowHtml="",waterHeightHtml="",timeStep=.1,timecount=0,arrow_left,arrow_right,time_counter=0,old_timer=!1,densityWater=997.0479,gravity=9.80665,gamma=9777.699788535,surfacePressureValue=101325,surfacePressure=101325,new_pressure=surfacePressure,head1=head2=headpipe=gaugePressure=0,tank1_height=tank2_height=400,tank1Data={height_meter:10,fillLevel_meter:5,radius_meter:.5,height_feet:30,fillLevel_feet:15,radius_feet:7.5,height_inches:80,fillLevel_inches:40,radius_inches:20,height_pixel:200,fillLevel_pixel:100,radius_pixel:50,x_pixel:100,y_pixel:0};tank1Data.mult_meter=tank1Data.height_pixel/tank1Data.height_meter,tank1Data.mult_feet=tank1Data.height_pixel/tank1Data.height_feet,tank1Data.mult_inches=tank1Data.height_pixel/tank1Data.height_inches;var pipeData={x_pixel:200,y_pixel:575,radius_pixel:50,height_pixel:50,fillLevel_pixel:50,height_meter:1,fillLevel_meter:1,radius_meter:.25,height_feet:4,fillLevel_feet:4,radius_feet:4,height_inches:10,fillLevel_inches:10,radius_inches:10};pipeData.mult_meter=pipeData.height_pixel/pipeData.height_meter,pipeData.mult_feet=pipeData.height_pixel/pipeData.height_feet,pipeData.mult_inches=pipeData.height_pixel/pipeData.height_inches;var tank2Data={height_meter:10,fillLevel_meter:5,radius_meter:.5,height_feet:30,fillLevel_feet:15,radius_feet:7.5,height_inches:80,fillLevel_inches:40,radius_inches:20,height_pixel:200,fillLevel_pixel:100,radius_pixel:50,x_pixel:400,y_pixel:0};tank2Data.mult_meter=tank2Data.height_pixel/tank2Data.height_meter,tank2Data.mult_feet=tank2Data.height_pixel/tank2Data.height_feet,tank2Data.mult_inches=tank2Data.height_pixel/tank2Data.height_inches;var drawHeightBuffer=75,tickType="meters";tickSpacing={},tickSpacing.meters=1,tickSpacing.inches=10,tickSpacing.feet=5;var tickDistance={meters:20,inches:25,feet:33.33},tank1_y_buffer=tank1Data.height_pixel+75,tank2_y_buffer=tank2Data.height_pixel+75,equalize_function=!1,pressureUnits="kPa",flowUnits="m/s",heightUnits="meters";let data=[];const margin_top=20,margin_right=30,margin_bottom=30,margin_left=40,width=800-margin_left-margin_right,height=400-margin_top-margin_bottom;let svg,x,y,xAxis,yAxis,line,path,svg2,x2,y2,xAxis2,yAxis2,line21,line22,path21,path22;slc.init=function(){console.log("init"),bkgStage=new createjs.Stage("bkgCanvas"),tank1Stage=new createjs.Stage("tank1Canvas"),tank2Stage=new createjs.Stage("tank2Canvas"),gaugeStage=new createjs.Stage("gaugeCanvas"),tickmarkStage=new createjs.Stage("tickmarkCanvas"),gaugeStage.enableMouseOver(10),slc.drawBkg(),slc.drawTanks(),slc.drawFlowMeter(),slc.drawPressureMeter(),slc.initUIElm();var img_leftarrow=new Image;img_leftarrow.src="img/arrow_left.png",img_leftarrow.onload=function imgLeftarrowLoad(){(arrow_left=new createjs.Bitmap(this)).x=tank2Data.x_pixel,arrow_left.y=bkgStage.canvas.height-125};var img_rightarrow=new Image;img_rightarrow.src="img/arrow_right.png",img_rightarrow.onload=function imgRightarrowLoad(){(arrow_right=new createjs.Bitmap(this)).x=tank1Data.x_pixel+2*tank1Data.radius_pixel-50,arrow_right.y=bkgStage.canvas.height-125},bkgStage.update(),$("#pressureUnits").val(pressureUnits).change(),$("#flowUnits").val(flowUnits).change(),createjs.Ticker.setFPS(30),createjs.Ticker.addEventListener("tick",slc.tick),gaugeStage.enableDOMEvents(!0),createjs.Touch.enable(gaugeStage),this.createD31Graph(),this.createD32Graph()},slc.createD31Graph=function(){console.log("create");const margin_top$0=20,margin_right$0=30,margin_bottom$0=50,margin_left$0=80,width=700-margin_left$0-margin_right$0,height=400-margin_top$0-margin_bottom$0;svg=d3.select("#d3chart1").append("svg").attr("width",width+margin_left$0+margin_right$0).attr("height",height+margin_top$0+margin_bottom$0).append("g").attr("transform",`translate(${margin_left$0},${margin_top$0})`),x=d3.scaleLinear().range([0,width]),y=d3.scaleLinear().range([height,0]),xAxis=svg.append("g").attr("class","x-axis").attr("transform",`translate(0,${height})`),yAxis=svg.append("g").attr("class","y-axis"),line=d3.line().x(d=>x(d.time)).y(d=>y(d.speed)),path=svg.append("path").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5),svg.append("text").attr("class","x label").attr("text-anchor","end").attr("x",width/2).attr("y",height+margin_bottom$0-10).text("Time (seconds)"),svg.append("text").attr("class","y label").attr("text-anchor","end").attr("y",15-margin_left$0).attr("x",-height/4).attr("dy",".75em").attr("transform","rotate(-90)").text("Speed of Flow in Pipe")},slc.updateD31Graph=function(data){let yUnitLabel;switch(flowUnits){case"m/s":yUnitLabel=" m/s",yTickStep="5";break;case"ft/sec":yUnitLabel=" ft/sec",yTickStep="10";break;case"mph":yUnitLabel=" mph",yTickStep="5";break;case"km/hr":yUnitLabel=" km/hr",yTickStep="10";break;default:yUnitLabel="1"}x.domain([0,d3.max(data,d=>Math.ceil(2*d.time)/2)]),y.domain([0,d3.max(data,d=>d.speed)]),xAxis.call(d3.axisBottom(x).tickFormat(d3.format(".1f")).ticks(d3.max(data,d=>Math.ceil(2*d.time)/2)/.5)),yAxis.call(d3.axisLeft(y).tickFormat(d=>`${d}${yUnitLabel}`).ticks(5)),svg.selectAll(".grid").remove(),svg.append("g").attr("class","grid").attr("transform",`translate(0,${height})`).call(d3.axisBottom(x).tickSize(-height).tickFormat("").ticks(d3.max(data,d=>Math.ceil(2*d.time)/2)/.5)),svg.append("g").attr("class","grid").call(d3.axisLeft(y).tickSize(-width).tickFormat("").ticks(5)),path.datum(data).attr("d",line);const points=svg.selectAll("circle").data(data);points.enter().append("circle").attr("fill","red").attr("r",5).merge(points).attr("cx",d=>x(d.time)).attr("cy",d=>y(d.speed)).append("title").text(d=>`Time: ${d.time.toFixed(1)} s, Speed: ${d.speed.toFixed(1)} ${flowUnits}`),points.exit().remove();var d3table=document.getElementById("d3table1");const table=document.createElement("table");table.className="datatable";const thead=document.createElement("thead"),headerRow=document.createElement("tr"),timeHeader=document.createElement("th");timeHeader.textContent="Time (s)",headerRow.appendChild(timeHeader);const speedHeader=document.createElement("th");speedHeader.textContent=`Speed (${flowUnits})`,headerRow.appendChild(speedHeader),thead.appendChild(headerRow),table.appendChild(thead);const tbody=document.createElement("tbody");data.forEach(d=>{const row=document.createElement("tr"),timeCell=document.createElement("td");timeCell.textContent=d.time.toFixed(1),row.appendChild(timeCell);const speedCell=document.createElement("td");speedCell.textContent=d.speed.toFixed(2),row.appendChild(speedCell),tbody.appendChild(row)}),table.appendChild(tbody),d3table.innerHTML="",d3table.appendChild(table)},slc.createD32Graph=function(){console.log("create second graph");const margin_top$0=20,margin_right$0=30,margin_bottom$0=50,margin_left$0=80,width=700-margin_left$0-margin_right$0,height=400-margin_top$0-margin_bottom$0;svg2=d3.select("#d3chart2").append("svg").attr("width",width+margin_left$0+margin_right$0).attr("height",height+margin_top$0+margin_bottom$0).append("g").attr("transform",`translate(${margin_left$0},${margin_top$0})`),x2=d3.scaleLinear().range([0,width]),y2=d3.scaleLinear().range([height,0]),xAxis2=svg2.append("g").attr("class","x-axis").attr("transform",`translate(0,${height})`),yAxis2=svg2.append("g").attr("class","y-axis"),line21=d3.line().x(d=>x2(d.time)).y(d=>y2(d.value1)),line22=d3.line().x(d=>x2(d.time)).y(d=>y2(d.value2)),path21=svg2.append("path").attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5),path22=svg2.append("path").attr("fill","none").attr("stroke","red").attr("stroke-width",1.5),svg2.append("text").attr("class","x label").attr("text-anchor","end").attr("x",width/2).attr("y",height+margin_bottom$0-10).text("Time (seconds)"),svg2.append("text").attr("class","y label").attr("text-anchor","end").attr("y",15-margin_left$0).attr("x",-height/4).attr("dy",".75em").attr("transform","rotate(-90)").text("Height of water in Tanks")},slc.updateD32Graph=function(data){let yUnitLabel;yUnitLabel=" m",x2.domain([0,d3.max(data,d=>d.time)]),y2.domain([0,d3.max(data,d=>Math.max(d.height1,d.height2))]);const numberOfXTicks=Math.ceil(d3.max(data,d=>d.time)/2);xAxis2.call(d3.axisBottom(x2).tickFormat(d3.format(".1f")).ticks(numberOfXTicks)),yAxis2.call(d3.axisLeft(y2).tickFormat(d=>`${d}${yUnitLabel}`).ticks(5)),svg2.selectAll(".grid").remove(),svg2.append("g").attr("class","grid").attr("transform",`translate(0,${height})`).call(d3.axisBottom(x2).tickSize(-height).tickFormat("").ticks(2*d3.max(data,d=>d.time))),svg2.append("g").attr("class","grid").call(d3.axisLeft(y2).tickSize(-width).tickFormat("").ticks(5)),path21.datum(data).attr("d",line21),path22.datum(data).attr("d",line22);const points21=svg2.selectAll("circle.height1").data(data);points21.enter().append("circle").attr("class","height1").attr("fill","blue").attr("r",5).merge(points21).attr("cx",d=>x2(d.time)).attr("cy",d=>y2(d.height1)).append("title").text(d=>`Time: ${d.time.toFixed(1)} s, Height1: ${d.height1.toFixed(1)}${yUnitLabel}`),points21.exit().remove();const points22=svg2.selectAll("circle.height2").data(data);points22.enter().append("circle").attr("class","height2").attr("fill","red").attr("r",5).merge(points22).attr("cx",d=>x2(d.time)).attr("cy",d=>y2(d.height2)).append("title").text(d=>`Time: ${d.time.toFixed(1)} s, Height2: ${d.height2.toFixed(1)}${yUnitLabel}`),points22.exit().remove();var d3table=document.getElementById("d3table2");const table=document.createElement("table");table.className="datatable";const thead=document.createElement("thead"),headerRow=document.createElement("tr"),timeHeader=document.createElement("th");timeHeader.textContent="Time (s)",headerRow.appendChild(timeHeader);const height1Header=document.createElement("th");height1Header.textContent="Tank 1 Height (meters)",headerRow.appendChild(height1Header);const height2Header=document.createElement("th");height2Header.textContent="Tank 2 Height (meters)",headerRow.appendChild(height2Header),thead.appendChild(headerRow),table.appendChild(thead);const tbody=document.createElement("tbody");data.forEach(d=>{const row=document.createElement("tr"),timeCell=document.createElement("td");timeCell.textContent=d.time.toFixed(1),row.appendChild(timeCell);const height1Cell=document.createElement("td");height1Cell.textContent=d.height1.toFixed(2),row.appendChild(height1Cell);const height2Cell=document.createElement("td");height2Cell.textContent=d.height2.toFixed(2),row.appendChild(height2Cell),tbody.appendChild(row)}),table.appendChild(tbody),d3table.innerHTML="",d3table.appendChild(table)},slc.tick=function(event){var checkPressureUnit=pressureMeter._units;pressureUnits!=checkPressureUnit&&($("#pressureUnits").val(checkPressureUnit).attr("selected",!0).siblings("option").removeAttr("selected"),$("#pressureUnits").change());var checkFlowUnit=flowMeter._units;flowUnits!=checkFlowUnit&&($("#flowUnits").val(checkFlowUnit).attr("selected",!0).siblings("option").removeAttr("selected"),$("#flowUnits").change()),selectedLevel1=parseInt($("#selectedLevel1").val()),selectedLevel2=parseInt($("#selectedLevel2").val()),(selectedLevel1>tank1._height||selectedLevel1<0)&&($("#selectedLevel1").val(tank1._fillLevel),selectedLevel1=parseInt($("#selectedLevel1").val())),(selectedLevel2>tank2._height||selectedLevel2<0)&&(selectedLevel2=parseInt($("#selectedLevel2").val())),1==equalize_function?(selectedLevel1=Number(selectedLevel1),(selectedLevel2=Number(selectedLevel2))==selectedLevel1||selectedLevel2>selectedLevel1&&selectedLevel2<=selectedLevel1+1||selectedLevel2<selectedLevel1&&selectedLevel2>=selectedLevel1-1||selectedLevel1>selectedLevel2&&selectedLevel1<=selectedLevel2+1||selectedLevel1<selectedLevel2&&selectedLevel1>=selectedLevel2-1?(slc.calcFlow(),d3Data1Staging.push({time:Number(timecount),speed:Number(0)}),slc.updateD31Graph(d3Data1Staging),slc.chartTankHeights(timecount),slc.updateD32Graph(d3Data2Staging),$("#stopCock").click(),selectedLevel2=selectedLevel1,slc.updateValueFlow(flowMeter,0,flowMeter._units,$("#flowUnits option:selected").val())):(selectedLevel1>selectedLevel2||selectedLevel1<selectedLevel2)&&slc.calcFlow()):(slc.flowFrom1To2Remove(),slc.flowFrom2To1Remove(),tank1._fillLevel<selectedLevel1?(tank1.changeLevel(selectedLevel1),tank1Data.fillLevel_pixel=selectedLevel1):tank1._fillLevel>selectedLevel1&&(tank1.changeLevel(selectedLevel1),tank1Data.fillLevel_pixel=selectedLevel1),tank2._fillLevel<selectedLevel2?(tank2.changeLevel(selectedLevel2),tank2Data.fillLevel_pixel=selectedLevel2):tank2._fillLevel>selectedLevel2&&(tank2.changeLevel(selectedLevel2),tank2Data.fillLevel_pixel=selectedLevel2),slc.calcFillLevelActual()),slc.getPressure(),tank1Stage.update(),tank2Stage.update(),gaugeStage.update()},slc.calcFlow=function(){V_T1=Math.PI*(tank1Data.radius_meter*tank1Data.radius_meter)*tank1Data.fillLevel_meter,V_T2=Math.PI*(tank2Data.radius_meter*tank2Data.radius_meter)*tank2Data.fillLevel_meter;var V_T1_old=V_T1,V_T2_old=V_T2,flowSpeed=0;tank1Data.fillLevel_meter>tank2Data.fillLevel_meter?flowSpeed=Math.sqrt(19.6133*(tank1Data.fillLevel_meter-tank2Data.fillLevel_meter)):tank2Data.fillLevel_meter>tank1Data.fillLevel_meter&&(flowSpeed=Math.sqrt(19.6133*(tank2Data.fillLevel_meter-tank1Data.fillLevel_meter))),lastFlowSpeed=flowSpeed;var R_p=.5,V_flowRate=Math.PI*(pipeData.radius_meter*pipeData.radius_meter)*flowSpeed;flowUnits=$("#flowUnits option:selected").val();var newFlowSpeed=slc.updateValueFlow(flowMeter,flowSpeed,flowUnits,"m/s"),time=1e3*timecount;d3Data1Staging.push({time:Number(time/1e3),speed:Number(newFlowSpeed)}),slc.chartTankHeights(time/1e3),timecount+=.1,tank1Data.fillLevel_meter>tank2Data.fillLevel_meter?(tank1Data.fillLevel_meter=(V_T1_old-.1*V_flowRate)/(Math.PI*(tank1Data.radius_meter*tank1Data.radius_meter)),tank2Data.fillLevel_meter=(V_T2_old+.1*V_flowRate)/(Math.PI*(tank2Data.radius_meter*tank2Data.radius_meter))):tank2Data.fillLevel_meter>tank1Data.fillLevel_meter&&(tank1Data.fillLevel_meter=(V_T1_old+.1*V_flowRate)/(Math.PI*(tank1Data.radius_meter*tank1Data.radius_meter)),tank2Data.fillLevel_meter=(V_T2_old-.1*V_flowRate)/(Math.PI*(tank2Data.radius_meter*tank2Data.radius_meter))),tank1.changeLevel(tank1Data.fillLevel_meter*tank1Data.mult_meter),tank2.changeLevel(tank2Data.fillLevel_meter*tank2Data.mult_meter),slc.updateSliderVal(1,tank1._fillLevel),slc.updateSliderVal(2,tank2._fillLevel)},slc.chartTankHeights=function(time){"meters"==tickType?d3Data2Staging.push({time:Number(time),height1:Number(tank1Data.fillLevel_meter),height2:Number(tank2Data.fillLevel_meter)}):"feet"==tickType?d3Data2Staging.push({time:Number(time),height1:Number(tank1Data.fillLevel_feet),height2:Number(tank2Data.fillLevel_feet)}):"inches"==tickType&&d3Data2Staging.push({time:Number(time),height1:Number(tank1Data.fillLevel_inches),height2:Number(tank2Data.fillLevel_inches)})},slc.getPressure=function(){var gaugeY_actual,gaugeX_actual,pressureHeight,head1,head2,tank1_meter_height,tank1_meter_fillLevel,tank2_meter_fillLevel,tank_mult,pipe_height,pipeFillLevel,pipe_mult;"meters"==tickType?(tank1_meter_height=tank1Data.height_meter,tank2_meter_height=tank2Data.height_meter,tank1_meter_fillLevel=tank1Data.fillLevel_meter,tank2_meter_fillLevel=tank2Data.fillLevel_meter,tank1_mult=tank1Data.mult_meter,tank2_mult=tank2Data.mult_meter,pipe_height=pipeData.height_meter,pipeFillLevel=pipeData.fillLevel_meter,pipe_mult=pipeData.mult_meter):"feet"==tickType?(tank1_meter_height=12*tank1Data.height_feet/39.37,tank2_meter_height=12*tank2Data.height_feet/39.37,tank1_meter_fillLevel=12*tank1Data.fillLevel_feet/39.37,tank2_meter_fillLevel=12*tank2Data.fillLevel_feet/39.37,tank1_mult=tank1Data.mult_feet/12*39.37,tank2_mult=tank2Data.mult_feet/12*39.37,pipe_height=12*pipeData.height_meter/39.37,pipeFillLevel=12*pipeData.fillLevel_feet/39.37,pipe_mult=pipeData.mult_feet/12*39.37):"inches"==tickType&&(tank1_meter_height=tank1Data.height_inches/39.37,tank2_meter_height=tank2Data.height_inches/39.37,tank1_meter_fillLevel=tank1Data.fillLevel_inches/39.37,tank2_meter_fillLevel=tank2Data.fillLevel_inches/39.37,tank1_mult=39.37*tank1Data.mult_inches,tank2_mult=39.37*tank2Data.mult_inches,pipe_height=39.37*pipeData.height_meter,pipeFillLevel=39.37*pipeData.fillLevel_inches,pipe_mult=39.37*pipeData.mult_inches);var gaugeY=pressureMeter.getGaugeY(),gaugeX=pressureMeter.getGaugeX();head1=tank1_meter_fillLevel+surfacePressure/gamma,head2=tank2_meter_fillLevel+surfacePressure/gamma,headpipe=pipeFillLevel+surfacePressure/gamma;var tank1_calc_height=tank1Data.height_pixel+tank1Data.y_pixel,tank1_calc_fillLevel=tank1Data.y_pixel+tank1Data.height_pixel-tank1Data.fillLevel_pixel,tank1_calc_width=2*tank1Data.radius_pixel+tank1Data.x_pixel,tank1_calc_height=tank1Data.height_pixel+tank1Data.y_pixel,tank2_calc_height=tank2Data.height_pixel+tank2Data.y_pixel,tank2_calc_fillLevel=tank2Data.y_pixel+tank2Data.height_pixel-tank2Data.fillLevel_pixel,tank2_calc_width=2*tank2Data.radius_pixel+tank2Data.x_pixel,tank2_calc_height=tank2Data.height_pixel+tank2Data.y_pixel,pipe_calc_height=pipeData.height_pixel+pipeData.y_pixel,pipe_calc_fillLevel=pipeData.y_pixel+pipeData.height_pixel-pipeData.fillLevel_pixel;gaugeX>tank1Data.x_pixel&&gaugeX<tank1_calc_width&&gaugeY>tank1_calc_fillLevel&&gaugeY<tank1_calc_height?(gaugeY_actual=(gaugeY-tank1Data.y_pixel)/tank1_mult,gaugeX_actual=gaugeX/tank1_mult,pressureHeight=tank1_meter_height-gaugeY_actual,gaugePressure=gamma*(head1-pressureHeight),slc.updateValue(pressureMeter,gaugePressure,pressureUnits,pressureUnits)):gaugeX>tank2Data.x_pixel&&gaugeX<tank2_calc_width&&gaugeY>tank2_calc_fillLevel&&gaugeY<tank2_calc_height?(gaugeY_actual=(gaugeY-tank2Data.y_pixel)/tank2_mult,gaugeX_actual=gaugeX/tank2_mult,pressureHeight=tank2_meter_height-gaugeY_actual,gaugePressure=gamma*(head2-pressureHeight),slc.updateValue(pressureMeter,gaugePressure,pressureUnits,pressureUnits)):gaugeX>pipeData.x_pixel-5&&gaugeX<pipeData.x_pixel+4*pipeData.radius_pixel+5&&gaugeY>pipe_calc_fillLevel&&gaugeY<pipe_calc_height?(gaugeX_actual=gaugeX/pipe_mult,pressureHeight=pipe_height-(gaugeY_actual=(gaugeY-pipeData.y_pixel)/pipe_mult),gaugePressure=gamma*(headpipe-pressureHeight),slc.updateValue(pressureMeter,gaugePressure,pressureUnits,pressureUnits)):slc.updateValue(pressureMeter,surfacePressure,pressureUnits,pressureUnits)},slc.flowFrom1To2=function(){bkgStage.addChild(arrow_right),bkgStage.update()},slc.flowFrom1To2Remove=function(){bkgStage.removeChild(arrow_right),bkgStage.update()},slc.flowFrom2To1=function(){bkgStage.addChild(arrow_left),bkgStage.update()},slc.flowFrom2To1Remove=function(){bkgStage.removeChild(arrow_left),bkgStage.update()},slc.updateSliderVal=function(tanknum,val){$("#selectedLevel"+tanknum).val(val),$("#selectedLevel"+tanknum+"-range-min").slider("value",val),1==tanknum?tank1Data.fillLevel_pixel=val:2==tanknum&&(tank2Data.fillLevel_pixel=val),slc.calcFillLevelActual(),slc.getPressure()},slc.drawBkg=function(){var bgShape=new createjs.Shape;bgShape.graphics.beginLinearGradientFill(["#728fce","#dee0d5","#dee0d5","#f4a460"],[.4,.65,.7,.9],0,0,0,bkgStage.canvas.height),bgShape.graphics.drawRect(0,0,bkgStage.canvas.width,bkgStage.canvas.height),bgShape.graphics.endFill(),bkgStage.addChild(bgShape);var grndShape=new createjs.Shape;grndShape.graphics.beginFill("#A0B873"),grndShape.graphics.drawRect(0,bkgStage.canvas.height-100,bkgStage.canvas.width,bkgStage.canvas.height),grndShape.graphics.endFill(),bkgStage.addChild(grndShape)},slc.drawPressureMeter=function(){var props;(pressureMeter=new Gauge({radius:25,height:40,width:60,color:"#CC0000",toMeasure:"pressure",units:pressureUnits,value:0,dragEnabled:!0,onMove:function(){slc.getPressure(),gaugeStage.update()}})).x=bkgStage.canvas.width-75,pressureMeter.y=tank1Data.height_pixel+300,gaugeStage.addChild(pressureMeter),gaugeStage.update(),slc.updateValue(pressureMeter,surfacePressure,"kPa","pascals"),pressureMeter.on("pressup",(function pressureMeterPressup(evt){slc.getPressure()}))},slc.drawFlowMeter=function(){var props;(flowMeter=new Gauge({radius:25,height:40,width:60,color:"#CCCCCC",toMeasure:"flow",units:flowUnits,value:0,dragEnabled:!1})).x=185+tank1Data.radius_pixel,flowMeter.y=bkgStage.canvas.height-50-75,gaugeStage.addChild(flowMeter),gaugeStage.update(),slc.updateValueFlow(flowMeter,0,"m/s","m/s"),flowMeter.on("pressup",(function flowMeterPressup(evt){var old_units_flow=flowMeter._units;flowUnits=$("#flowUnits option:selected").val();var old_flow=flowMeter._actualValue;slc.updateValueFlow(flowMeter,old_flow,old_units_flow,flowUnits)}))},slc.drawTanks=function(){var fillLevel1,fillLevel2;"meters"==tickType?(fillLevel1=tank1Data.mult_meter*tank1Data.fillLevel_meter,fillLevel2=tank2Data.mult_meter*tank2Data.fillLevel_meter):"feet"==tickType?(fillLevel1=tank1Data.mult_feet*tank1Data.fillLevel_feet,fillLevel2=tank2Data.mult_feet*tank2Data.fillLevel_feet):"inches"==tickType&&(fillLevel1=tank1Data.mult_inches*tank1Data.fillLevel_inches,fillLevel2=tank2Data.mult_inches*tank2Data.fillLevel_inches);var props2={radius:tank1Data.radius_pixel,height:tank1Data.height_pixel,fillLevel:fillLevel1,color:"3399FF"};$("#selectedLevel1").val(fillLevel1),(tank1=new Tank(props2)).x=tank1Data.x_pixel,tank1.y=tank1Data.y_pixel=bkgStage.canvas.height-tank1_y_buffer,props2=null,tank1Stage.addChild(tank1);var props4={radius:tank2Data.radius_pixel,height:tank2Data.height_pixel,fillLevel:fillLevel2,color:"3399FF"};$("#selectedLevel2").val(fillLevel2),(tank2=new Tank(props4)).x=tank2Data.x_pixel,tank2.y=tank2Data.y_pixel=bkgStage.canvas.height-tank2_y_buffer,props4=null,tank2Stage.addChild(tank2);var tubeGraphics=new createjs.Graphics;tubeGraphics.beginFill(createjs.Graphics.getRGB("0x3399FF",.75)).drawRect(pipeData.x_pixel,pipeData.y_pixel-10,4*pipeData.radius_pixel,pipeData.height_pixel).endFill();var tube=new createjs.Shape(tubeGraphics),tubeGraphicsOutline=new createjs.Graphics;tubeGraphicsOutline.setStrokeStyle(4).beginStroke("rgba(0,0,0,1)").drawRect(pipeData.x_pixel,pipeData.y_pixel-10,4*pipeData.radius_pixel,pipeData.height_pixel).closePath();var tubeOutline=new createjs.Shape(tubeGraphicsOutline);bkgStage.addChild(tube),bkgStage.addChild(tubeOutline);var bitmap=new createjs.Bitmap("img/flowvalve.png");bitmap.x=100+2*tank1Data.radius_pixel+12,bitmap.y=bkgStage.canvas.height-140,bkgStage.addChild(bitmap)},slc.calcFillLevelActual=function(){tank1Data.fillLevel_meter=tank1Data.fillLevel_pixel/tank1Data.mult_meter,tank2Data.fillLevel_meter=tank2Data.fillLevel_pixel/tank1Data.mult_meter,tank1Data.fillLevel_feet=tank1Data.fillLevel_pixel/tank1Data.mult_feet,tank2Data.fillLevel_feet=tank2Data.fillLevel_pixel/tank1Data.mult_feet,tank1Data.fillLevel_inches=tank1Data.fillLevel_pixel/tank1Data.mult_inches,tank2Data.fillLevel_inches=tank2Data.fillLevel_pixel/tank1Data.mult_inches},slc.drawTickMarks=function(){tank1_height_convert=tank1Data.height_pixel,tank1_y_convert=tank1.y,tank1_x_convert=tank1.x,tank2_y_convert=tank2.y,tank2_x_convert=tank2.x,"meters"==tickType?(tank1_height_actual_convert=tank1Data.height_meter,tank1_height_mult_convert=tank1Data.mult_meter):"feet"==tickType?(tank1_height_actual_convert=tank1Data.height_feet,tank1_height_mult_convert=tank1Data.mult_feet):"inches"==tickType&&(tank1_height_actual_convert=tank1Data.height_inches,tank1_height_mult_convert=tank1Data.mult_inches);for(var spacing=tickDistance[tickType],counter=0,i=0;i<tank1_height_convert+tank1_y_convert;i+=spacing){var numGraphic=(tank1_height_actual_convert-counter*tickSpacing[tickType]).toFixed(2);if(numGraphic>=0){var text1=new createjs.Text(Math.abs(numGraphic),"bold 12px Arial","#000000"),text2=new createjs.Text(Math.abs(numGraphic),"bold 12px Arial","#000000");text1.x=tank1Data.x_pixel-90,text1.y=tank1Data.y_pixel+i,text2.x=tank2Data.x_pixel+2*tank2Data.radius_pixel+60,text2.y=tank2Data.y_pixel+i;var tickmark=new createjs.Graphics;tickmark.setStrokeStyle(1).beginStroke("rgba(0,0,0,.25)").moveTo(tank1_x_convert-55,tank1_y_convert+i).lineTo(tank2_x_convert+55+2*tank2Data.radius_pixel,tank2_y_convert+i).closePath();var tickmarkOutline=new createjs.Shape(tickmark);tickmarkStage.addChild(tickmarkOutline,text1,text2)}counter++}tickmarkStage.update()},slc.initUIElm=function(){var ruler1=new createjs.Graphics;ruler1.setStrokeStyle(10).beginStroke("rgba(0,0,0,1)").moveTo(tank1.x-50,tank1.y).lineTo(tank1.x-50,tank1Data.height_pixel+tank1.y).closePath();var ruler1Outline=new createjs.Shape(ruler1);bkgStage.addChild(ruler1Outline);var ruler2=new createjs.Graphics;ruler2.setStrokeStyle(10).beginStroke("rgba(0,0,0,1)").moveTo(tank2.x+50+2*tank2Data.radius_pixel,tank2.y).lineTo(tank2.x+50+2*tank2Data.radius_pixel,tank2Data.height_pixel+tank2.y).closePath();var ruler2Outline=new createjs.Shape(ruler2);slc.drawTickMarks(),bkgStage.addChild(ruler1Outline,ruler2Outline),$("#selectedLevel1-range-min").slider({value:tank1Data.fillLevel_pixel,min:0,max:tank1Data.height_pixel,orientation:"vertical",slide:function selectedLevel1SliderSlide(event,ui){$("#selectedLevel1").val(ui.value)},change:function selectedLevel1SliderChange(event,ui){$("#selectedLevel1").val(ui.value),selectedLevel1=$("#selectedLevel1").val(),slc.getSelectedVal(1,selectedLevel1),slc.getPressure()}}),$("#selectedLevel1_actual").val($("#selectedLevel1").val()/tank1Data.mult_meter),slc.getSelectedVal(1,$("#selectedLevel1-range-min").slider("value")),$("#selectedLevel2-range-min").slider({value:tank2Data.fillLevel_pixel,min:0,max:tank2Data.height_pixel,orientation:"vertical",slide:function selectedLevel2SliderSlide(event,ui){$("#selectedLevel2").val(ui.value)},change:function selectedLevel2SliderChange(event,ui){$("#selectedLevel2").val(ui.value),selectedLevel2=$("#selectedLevel2").val(),slc.getSelectedVal(2,selectedLevel2),slc.getPressure()}}),$("#selectedLevel2").val(),slc.getSelectedVal(2,$("#selectedLevel2-range-min").slider("value")),$(".pressure_units").html("(in "+tickType+")"),$("#heightUnits").find('option[value="'+tickType+'"]').attr("selected",!0),$("#pressureUnits").find('option[value="'+pressureUnits+'"]').attr("selected",!0),$("#flowUnits").find('option[value="'+flowUnits+'"]').attr("selected",!0)},slc.getSelectedVal=function(index,level){var newVal;switch(mult=tank2Data.mult_meter,tickType){case"meters":newVal=1==index?level/tank1Data.mult_meter:level/tank2Data.mult_meter;break;case"feet":newVal=1==index?level/tank1Data.mult_feet:level/tank2Data.mult_feet;break;case"inches":newVal=1==index?level/tank1Data.mult_inches:level/tank2Data.mult_inches}$("#selectedLevel"+index+"_actual").val(newVal.toFixed(2))},$("#incSurfacePressure").on("change",(function increaseSurfacePressureChange(){surfacePressure=$(this).is(":checked")?101325:0})),$("#stopCock").on("click",(function stopCockClick(){var val;timecount=0,"Off"==$(this).val()?($(this).val("On"),$(this).html("On"),equalize_function=!0,d3Data1Staging=[],d3Data2Staging=[]):($(this).val("Off"),$(this).html("Off"),equalize_function=!1)})),$("#equalize").on("click",(function equalizeClick(){equalize_function="On"==$("#stopCock").val()})),slc.updateValue=function(meterObj,old_pressure,new_units,old_units){switch(new_units){case"psi":"kPa"==old_units?new_pressure=1e3*old_pressure/6894.76:"pascals"==old_units?new_pressure=old_pressure/6894.76:"millibars"==old_units?new_pressure=100*old_pressure/6894.76:"psi"==old_units?new_pressure=old_pressure/6894.76:console.log("unhandled psi");break;case"kPa":"pascals"==old_units?new_pressure=old_pressure/1e3:"psi"==old_units?new_pressure=6894.76*old_pressure/1e3:"millibars"==old_units?new_pressure=old_pressure/10:"kPa"==old_units?new_pressure=old_pressure/1e3:console.log("unhandled kPa");break;case"pascals":"kPa"==old_units?new_pressure=1e3*old_pressure:"psi"==old_units?new_pressure=6894.76*old_pressure:"millibars"==old_units?new_pressure=100*old_pressure:"pascals"==old_units?new_pressure=old_pressure:console.log("unhandled pascals");break;case"millibars":"kPa"==old_units?new_pressure=10*old_pressure:"psi"==old_units?new_pressure=old_pressure/100*6894.76:"pascals"==old_units?new_pressure=old_pressure/100:"millibars"==old_units?new_pressure=old_pressure/100:console.log("unhandled millibars");break;default:console.log("unhandled")}meterObj.changeActualValue(new_pressure),new_pressure=new_pressure.toFixed(2),meterObj.changeValue(new_pressure)},slc.updateValueFlow=function(meterObj,old_flow,new_units,old_units){var new_flow=0;switch(new_units){case"ft/sec":"m/s"==old_units?new_flow=3.28084*old_flow:"mph"==old_units?new_flow=old_flow*(5280/3600):"km/hr"==old_units?new_flow=old_flow*(3280/3600):"ft/sec"==old_units?new_flow=old_flow:console.log("unhandled ft/sec");break;case"mph":"m/s"==old_units?new_flow=old_flow*(3600/1609.34):"ft/sec"==old_units?new_flow=old_flow*(3600/5280):"km/hr"==old_units?new_flow=old_flow/1.60934:"mph"==old_units?new_flow=old_flow:console.log("unhandled mph");break;case"km/hr":"m/s"==old_units?new_flow=3.6*old_flow:"ft/sec"==old_units?new_flow=old_flow*(3600/3280):"mph"==old_units?new_flow=1.60934*old_flow:"km/hr"==old_units?new_flow=old_flow:console.log("unhandled km/hr");break;case"m/s":"ft/sec"==old_units?new_flow=old_flow/3.28084:"mph"==old_units?new_flow=old_flow*(1609.34/36e3):"km/hr"==old_units?new_flow=old_flow*(1e3/3600):"m/s"==old_units?new_flow=old_flow:console.log("unhandled m/s");break;default:console.log("unhandled")}return meterObj.changeActualValue(new_flow),meterObj.changeValue(new_flow.toFixed(2)),new_flow},$("#pressureUnits").on("change",(function pressureUnitChange(){var old_units=pressureMeter._units;pressureUnits=$("#pressureUnits option:selected").val(),pressureMeter.changeUnits(pressureUnits);var old_pressure=pressureMeter._actualValue;old_units!=pressureUnits&&slc.updateValue(pressureMeter,old_pressure,pressureUnits,old_units)})),$("#flowUnits").on("change",(function flowUnitChange(){var old_units_flow=flowMeter._units;flowUnits=$("#flowUnits option:selected").val(),this.flowUnits=flowUnits,flowMeter.changeUnits(flowUnits);var old_flow=flowMeter._actualValue;old_units_flow!=flowUnits&&slc.updateValueFlow(flowMeter,old_flow,flowUnits,old_units_flow)})),$("#heightUnits").on("change",(function heightUnitChange(){switch(tickType=$("#heightUnits option:selected").val(),this.heightUnits=tickType,slc.clearTickMarks(),slc.drawTickMarks(),tickType){case"feet":num1=tank1Data.fillLevel_feet,num2=tank2Data.fillLevel_feet;break;case"inches":num1=tank1Data.fillLevel_inches,num2=tank2Data.fillLevel_inches;break;case"meters":num1=tank1Data.fillLevel_meter,num2=tank2Data.fillLevel_meter}$("#selectedLevel1_actual").val(num1),$("#selectedLevel2_actual").val(num2)})),slc.init()}(jQuery);