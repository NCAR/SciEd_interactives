!function(window){var pressure_units=new Array("psi","millibars","pascals","kPa"),flow_units=new Array("m/s","ft/sec","mph","km/hr");function Gauge(obj){var self=this;radius=void 0!==obj.radius?obj.radius:5,height=void 0!==obj.height?obj.height:30,width=void 0!==obj.width?obj.width:30,color=void 0!==obj.color?obj.color:"#FFE900",value=void 0!==obj.value?obj.value:0,dragEnabled=void 0!==obj.dragEnabled&&obj.dragEnabled,"pressure"!=obj.toMeasure&&"flow"!=obj.toMeasure?obj.toMeasure=toMeasure="pressure":toMeasure=obj.toMeasure,"undefined"==obj.units?"pressure"==toMeasure?obj.units=units="kPa":"flow"==toMeasure&&(obj.units=units="mph"):units=obj.units,"psi"!=units&&"millibars"!=units&&"pascals"!=units&&"kPa"!=units||"flow"!=toMeasure?"m/s"!=units&&"ft/sec"!=units&&"mph"!=units&&"km/hr"!=units||"pressure"!=toMeasure||(obj.units=units="kPa"):obj.units=units="mph",this.initialize(radius,height,width,color,toMeasure,units,value,dragEnabled),dragEnabled&&this.enableKeyboardControls(obj.onMove)}var p=Gauge.prototype=new createjs.Container;p.Container_initialize=Gauge.prototype.initialize,p.Container_tick=Gauge.prototype._tick;var boxBuffer=10;p.initialize=function(radius,height,width,color,toMeasure,units,value,dragEnabled){this.Container_initialize(),this._radius=radius,this._height=height,this._width=width,this._color=color,this._toMeasure=toMeasure,this._units=units,this._maxTick=100,this._value=value,this._actualValue=value;var _dragEnabled=dragEnabled,box,meter;this._hex="0x"+this._color,this.text,this.dial,this.unitChanger=new createjs.Shape,this.boundingBox,this._measureX=-10,this._measureY=this._height/2,this.setMaxTick=function(){if("pressure"==this._toMeasure)switch(this._units){case"psi":this._maxTick=30;break;case"millibars":this._maxTick=2e3;break;case"pascals":this._maxTick=2e5;break;case"kPa":this._maxTick=200}else if("flow"==this._toMeasure)switch(this._units){case"m/s":this._maxTick=15;break;case"ft/sec":this._maxTick=50;break;case"mph":this._maxTick=35;break;case"km/hr":this._maxTick=50}},this.drawBox=function(){(box=new createjs.Shape).graphics.beginFill(this._color).drawRect(0,-10,this._width,this._height+30,5).endFill(),box.graphics.setStrokeStyle(2).beginStroke("rgba(0,0,0,1)").drawRect(0,-10,this._width,this._height+30,5).endStroke(),box.graphics.beginFill("#ffffff").arc(this._width/2,this._height/2+10,this._radius,0,Math.PI,!0).endFill();var title=new createjs.Text(this._toMeasure,"bold 12px Arial","#000000");title.textAlign="center",title.x=this._width/2,title.y=-8,this.addChild(box,title)},this.drawTickMarks=function(){var tickCont=new createjs.Container;for(tickCont.x=this._width/2,tickCont.y=this._height/2+10,deg=90;deg<=270;deg+=36){var radius=2,ticks=new createjs.Shape;ticks.graphics.beginFill("#CC0000").drawCircle(0,this._radius-5,2).endFill(),ticks.rotation=deg,tickCont.addChild(ticks)}this.addChild(tickCont)},this.drawDial=function(){this.dial=new createjs.Shape;var iValAsAngle=this.convertValueToAngle(this._value),iValAsAngleRad=this.degToRad(iValAsAngle),innerTickX=this._radius-Math.cos(iValAsAngleRad),innerTickY=this._height-(Math.sin(iValAsAngleRad)+5),fromX=this._width/2-this._radius+innerTickX,fromY=this._height/2-this._radius+innerTickY,endNeedleX=this._radius-Math.cos(iValAsAngleRad)*this._radius,endNeedleY=this._radius-Math.sin(iValAsAngleRad)*this._radius+10,toX=this._width/2-this._radius+endNeedleX,toY=this._height/2-this._radius+endNeedleY;this.dial.graphics.setStrokeStyle(2).beginStroke("#666666").moveTo(fromX,fromY).lineTo(toX,toY).endStroke(),this.addChild(this.dial)},this.drawText=function(){this.text=new createjs.Text(this._value+"\r\n"+this._units,"bold 12px Arial","#000000"),this.text.textAlign="center",this.text.y=this._height/2+this._radius-10,this.text.x=this._width/2,this.addChild(this.text)},this.drawUnitChanger=function(){this.unitChanger.graphics.beginFill("black"),this.unitChanger.graphics.setStrokeStyle(2).beginStroke("rgba(0,0,0,1)").drawRect(0,this._height+20,this._width,10,5).endStroke(),this.unitChanger.graphics.beginFill(this._color).drawRect(0,this._height+20,this._width,10,5).endFill();var btnTxt=new createjs.Text("Change Units","bold 8px Arial","#000000");btnTxt.textAlign="center",btnTxt.x=this._width/2,btnTxt.y=this._height+22,this.addChild(this.unitChanger,btnTxt)},this.drawGauge=function(){(meter=new createjs.Shape).graphics.beginFill(this._color).moveTo(0,-10).lineTo(-10,-10).lineTo(0,0).endFill(),meter.graphics.setStrokeStyle(2).beginStroke("#000000").moveTo(0,-10).lineTo(-10,-10).lineTo(0,0).endStroke(),meter.measureX=-10,meter.measureY=0,this.addChild(meter)},this.drawBox(),this.drawTickMarks(),this.drawDial(),this.drawText(),this.drawGauge(),this.setMaxTick(),this.drawUnitChanger();var hit=new createjs.Shape;hit.graphics.beginFill("#000").drawRect(-10,-10,this._width,this._height+20+20),this.hitArea=hit,this.on("click",this.handleClick),1==dragEnabled&&this.on("pressmove",this.handleDrag),this.mouseChildren=!1,this.cursor="pointer",this.on("pressup",(function gaugePressup(evt){})),this.unitChanger.on("click",(function gaugeUnitChangerClick(event){this.handleUnitChanger(evt)}))},p.getCoords=function(evt){this._measureY=evt.stageY,this._measureX=evt.stageX},p.handleDrag=function(evt){evt.target.x=evt.stageX+10,evt.target.y=evt.stageY+10,this.getCoords(evt)},p.handleUnitChanger=function(evt){if("pressure"==this._toMeasure){var index=pressure_units.indexOf(this._units);++index>=pressure_units.length&&(index=0),this._units=pressure_units[index]}else if("flow"==this._toMeasure){var index=flow_units.indexOf(this._units);++index>=flow_units.length&&(index=0),this._units=flow_units[index]}},p.handleClick=function(evt){var target=evt.target,clickLoc=evt.stageY-evt.target.y-10;clickLoc<this._height+20&&clickLoc>this._height&&this.handleUnitChanger(evt)},p.changeActualValue=function(value){this._actualValue=value},p.changeValue=function(value){this._value=value,this.text.set({text:this._value+"\r\n"+this._units}),this.dial.graphics.clear(),this.drawDial(),this.addChild(this.dial)},p.changeUnits=function(value){this._units=value,this.text.set({text:this._value+"\r\n"+this._units}),this.dial.graphics.clear(),this.drawDial(),this.addChild(this.dial),this.setMaxTick()},p.convertValueToAngle=function(val){var convert=180/this._maxTick,iSpeed;return iSpeedAsAngle=20*(val*convert/20)%180,iSpeedAsAngle>180?iSpeedAsAngle-=180:iSpeedAsAngle<0&&(iSpeedAsAngle+=180),iSpeedAsAngle},p.degToRad=function(angle){return angle*Math.PI/180},p.getGaugeY=function(){return this._measureY},p.getGaugeX=function(){return this._measureX},p._tick=function(){this.Container_tick()},p.enableKeyboardControls=function(onMoveCallback){var self=this;window.addEventListener("keydown",(function(event){var step=10,moved=!1;switch(event.key){case"w":self.y-=10,moved=!0;break;case"s":self.y+=10,moved=!0;break;case"a":self.x-=10,moved=!0;break;case"d":self.x+=10,moved=!0}moved&&(self.getCoords({stageX:self.x,stageY:self.y}),self.getStage().update(),"function"==typeof onMoveCallback&&onMoveCallback())}))},window.Gauge=Gauge}(window);